---
import Layout from '../../layouts/Layout.astro';
import Button from '../../components/Button.astro';
import DateTimeInput from '../../components/DateTimeInput.astro';
---

<Layout>
	<DateTimeInput />

	<div class="flex flex-col gap-1 w-full bg-primary p-4 mt-4">
		<div class="w-full flex justify-between">
			<h1 class="text-xl font-bold">Stock In Transactions</h1>
			<a href="/stockTransaction/Dashboard/">
				<Button class="text-btn-primary border-none w-fit hover:text-btn-primary">Back</Button>
			</a>
		</div>
		<div class="p-2 flex flex-col gap-4">
			<table class="w-full text-left">
				<thead>
					<tr>
						<th class="table-header">Reference no</th>
						<th class="table-header">Date</th>
						<th class="table-header">Supplier</th>
						<th class="table-header">Status</th>
						<th class="table-header text-center">Action</th>
					</tr>
				</thead>
				<tbody id="transactions-body"></tbody>
			</table>

			<div class="flex justify-between items-center flex-shrink-0">
				<button
					class="bg-btn-primary hover:bg-gray-600 text-textColor-secondary px-4 py-2 rounded font-medium transition-colors text-sm">Previous</button>
				<span class="text-textColor-primary text-sm">Page 1 of 1</span>
				<button
					class="bg-btn-primary hover:bg-gray-600 text-textColor-secondary px-4 py-2 rounded font-medium transition-colors text-sm">Next</button>
			</div>
		</div>
	</div>

	<!-- âœ… JavaScript for dynamic row rendering -->
	<script type="module" client:load>
		async function fetchTransactions() {
			try {
				const res = await fetch('/api/transactions/stockintransactions');
				if (!res.ok) throw new Error("Failed to fetch transactions");
				const data = await res.json();
				renderTable(data);
			} catch (err) {
				console.error('Error loading transactions:', err);
			}
		}

		function renderTable(transactions) {
			const tbody = document.querySelector('#transactions-body');
			tbody.innerHTML = ''; // clear existing

			transactions.forEach(log => {
				const tr = document.createElement('tr');
				tr.className = 'table-row';
				tr.innerHTML = `
					<td class="table-data">${log.ref_no}</td>
					<td class="table-data">${log.transaction_datetime}</td>
					<td class="table-data">${log.supplier_id}</td>
					<td class="table-data">${log.status}</td>
					<td class="table-data text-center">
						<button class="table-view-btn">View</button>
					</td>
				`;
				tbody.appendChild(tr);
			});
		}

		fetchTransactions();
	</script>
</Layout>