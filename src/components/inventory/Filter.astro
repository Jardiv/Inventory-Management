---
import { supabase } from "../../utils/supabaseClient";

// Fetch category data from Supabase
const { data: categories, error } = await supabase
  .from('category')
  .select('id, name')
  .order('name', { ascending: true });

if (error) {
  console.error("Failed to fetch categories:", error.message);
}
---

<div class="relative inline-block">
  <!-- Filter Button -->
  <button id="toggle-filters"
    class="items-center rounded px-4 py-2 pr-4 bg-primary text-textColor-primary hover:bg-violet-600 active:bg-violet-600">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
      stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <line x1="3" y1="6" x2="21" y2="6" />
      <line x1="6" y1="12" x2="18" y2="12" />
      <line x1="9" y1="18" x2="15" y2="18" />
    </svg>
  </button>

  <!-- Filter Panel -->
  <div id="filter-panel"
    class="absolute top-full left-1/2 -translate-x-1/2 mt-2 w-72 bg-primary text-textColor-primary rounded-lg p-4 border border-border_color shadow-lg hidden z-50">

    <h3 class="text-base font-semibold mb-2">Availability:</h3>
    <div class="flex flex-col gap-1 mb-4">
      <label><input type="checkbox" value="in_stock" class="availability-option mr-2">In Stock</label>
      <label><input type="checkbox" value="low_stock" class="availability-option mr-2">Low Stock</label>
      <label><input type="checkbox" value="out_of_stock" class="availability-option mr-2">Out of Stock</label>
    </div>

    <hr class="border-border_color mb-4">

    <h3 class="text-textColor-primary font-semibold mb-2">Category:</h3>
    <select id="category-filter" class="w-full bg-primary text-textColor-primary border border-neutral-700 rounded px-3 py-2 mb-4">
      <option value="">-- All Categories --</option>
      {
        categories?.map((cat) => (
          <option value={cat.id}>{cat.name}</option>
        ))
      }
    </select>

    <hr class="border-border_color mb-4">

    <h3 class="text-textColor-primary font-semibold mb-2">Price Range:</h3>
    <div class="flex justify-between gap-2">
      <input type="number" placeholder="Min:"
        class="w-1/2 bg-primary text-textColor-primary px-3 py-2 rounded border border-neutral-700" />
      <input type="number" placeholder="Max:"
        class="w-1/2 bg-primary text-textColor-primary px-3 py-2 rounded border border-neutral-700" />
    </div>

    <div class="flex justify-end mt-4">
      <button id="apply-filters-btn"
        class="bg-primary hover:bg-violet-600 text-textColor-primary font-semibold px-4 py-2 rounded transition-all duration-300">
        Apply Filters
      </button>
    </div>
  </div>
</div>
